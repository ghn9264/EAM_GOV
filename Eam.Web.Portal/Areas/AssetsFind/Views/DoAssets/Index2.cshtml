@model dynamic
@{
    ViewBag.Title = "资产操作";
    Layout = "~/Views/Shared/_AreasLayout.cshtml";
}
<style type="text/css">
    .content{min-height:0px}
</style>
<!-- Content Header (Page header) -->
<section class="content-header">
    <!--最顶部的标题栏-->
    <h1>
        固定资产<small>资产操作</small>
    </h1>
    <!--顶部标题栏右侧的层级显示栏-->
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Examples</a></li>
        <li class="active">Blank page</li>
    </ol>
</section>

<!-- 条件检索面板 -->
@*<section class="content">*@
    <div class="row">
        <!-- 条件检索面板 -->
        <div class="col-lg-12">
            <!-- 条件检索面板 -->
            <div class="box box-danger">
                <!-- 表头 -->
                <div class="box-header with-border">
                    <h3 class="box-title">检索条件</h3>
                    <div class="box-tools pull-right">
                        <button class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                    </div>
                </div><!-- /.box-header -->
                <!-- body -->
                <div class="box-body content">
                    <form method="get" id="frmSearch" name="frmSearch">
                        <!-- 检索条件输入区域 -->
                        <div class="row">
                            <!-- 第一列检索条件 -->
                            <div class="col-lg-4">
                                <div class="col-lg-12">
                                    <br />
                                    <label>资产名称：</label>
                                    <input class="form-control" type="text" placeholder="资产名称" maxlength="20" name="GoodsName" id="GoodsName" />
                                    <br />
                                    <label>资产编号：</label>
                                    <input class="form-control" type="text" placeholder="资产编号" maxlength="20" name="AssetsNum" id="AssetsNum" />
                                    <br />
                                    <label>取得方式：</label>
                                    <select class="form-control select2 select2-hidden-accessible" style="width: 100%;"
                                            tabindex="-1" aria-hidden="true" name="GetWay" id="GetWay">
                                        <option selected="selected">购置</option>
                                        <option>调拨</option>
                                        <option>自建</option>
                                        <option>捐赠</option>
                                        <option>划拨</option>
                                        <option>置换</option>
                                        <option>自行研制</option>
                                        <option>其他</option>
                                        <option>有偿取得</option>
                                        <option>租凭</option>
                                    </select>
                                    @*<br />
    <label>经办人：</label>
     <input class="form-control" type="text" placeholder="经办人" maxlength="5" name="Agent" id="Agent" />*@
                                </div>
                            </div>

                            <!-- 第二列检索条件 -->
                            <div class="col-lg-4">
                                <div class="col-lg-12">
                                    <br />
                                    <label>使用状况：</label>
                                    <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" tabindex="-1" aria-hidden="true" id="UsingState" name="UsingState">
                                        <option selected="selected">在用</option>
                                        <option>闲置</option>
                                        <option>摧毁待报废</option>
                                        <option>其他</option>
                                    </select>
                                    <br />
                                    <label>存放地点：</label><input class="form-control" type="text" placeholder="存放地点" id="StorePlace" name="StorePlace">
                                    @*<br />
        <label>会计凭证号：</label><input class="form-control" type="text" placeholder="Default input">*@
                                    <br />
                                    <label>使用人：</label><input class="form-control" type="text" placeholder="使用人" id="User" name="User">
                                </div>
                            </div>

                            <!-- 第三列检索条件 -->
                            <div class="col-lg-4">
                                <div class="col-lg-12">
                                    <br />
                                    <label>价值类型：</label>
                                    <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" tabindex="-1" aria-hidden="true" id="ValueType" name="ValueType">
                                        <option selected="selected">原值</option>
                                        <option>暂估值</option>
                                        <option>重置值</option>
                                        <option>无价值</option>
                                        <option>评估值</option>
                                    </select>
                                    <br />
                                    <label>价值范围：</label>
                                    <div class="row">
                                        <div class="col-lg-5"><input class="form-control" type="text" placeholder="0.00" id="ValueSearchStart" name="ValueSearchStart"></div>
                                        <div class="col-lg-2"><hr style="color:black;width:100%;border:0.5px solid black;" /></div>
                                        <div class="col-lg-5"><input class="form-control" type="text" placeholder="0.00" id="ValueSearchEnd" name="ValueSearchEnd"></div>
                                    </div>
                                    @*<br />
        <label>使用人：</label><input class="form-control" type="text" placeholder="Default input">*@
                                    <br />
                                    <label>使用属性：</label>
                                    <select class="form-control select2 select2-hidden-accessible" style="width: 100%;" tabindex="-1" aria-hidden="true" id="UsingAttribute" name="UsingAttribute">
                                        <option selected="selected">办公设备</option>
                                        <option>专用设备</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <br />
                            <input type="hidden" name="PageIndex" id="PageIndex" value="1"/>
                            <input type="hidden" name="PageSize" id="PageSize" value="20" />
                            <button type="submit" class="btn btn-primary col-lg-offset-4" id="btnSearch">筛选资产</button>
                            <button type="reset" class="btn btn-primary col-lg-offset-2">清除条件</button>
                        </div>
                    </form>
                </div>
            </div><!--/.box -->
        </div>

    </div>
@*</section>*@

<!-- 资产列表面板 -->
@*<section class="content">*@
    <div class="row">
        <!--资产列表面板 -->
        <div class="col-lg-12">
            <!-- 资产列表面板 -->
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">资产列表</h3>
                    <div class="box-tools pull-right">
                        <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    </div>
                </div><!-- /.box-header -->
                <div class="box-body">
                    <div id="example1_wrapper" class="dataTables_wrapper form-inline">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="dataTables_length" id="example1_length">
                                    <select name="perPageSize" id="perPageSize" class="form-control input-sm">
                                        <option value="10">10</option>
                                        <option value="20" selected>20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <table id="tableAssets" class="table table-bordered table-striped dataTable" role="grid">
                                    <thead>
                                        <tr role="row">
                                            <th colspan="1" style="width: 293px;">资产编号</th>
                                            <th rowspan="1" colspan="1" style="width: 359px;">资产名称</th>
                                            <th class="sorting" rowspan="1" colspan="1" style="width: 318px;">资产类别</th>
                                            <th class="sorting" rowspan="1" colspan="1" style="width: 256px;">单价</th>
                                            <th class="sorting" rowspan="1" colspan="1" style="width: 256px;">数量</th>
                                            <th class="sorting" rowspan="1" colspan="1" style="width: 256px;">计量单位</th>
                                            <th class="sorting" rowspan="1" colspan="1" style="width: 191px;">使用状况</th>
                                            <th class="sorting" rowspan="1" colspan="1">&nbsp;</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="dataTables_info" id="example1_info" role="status" aria-live="polite"></div>
                        </div>
                        <div class="col-sm-9">
                            <ul id="divAssetsPager"></ul>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="col-lg-3">
                            <button id="addAssetsToMaintainList" class="btn btn-primary btn-sm btn-flat">添加到操作列表</button>
                        </div>
                    </div>
                </div><!-- /.box-body -->
            </div>

        </div>

    </div>

@*</section>*@

<!-- 资产详情面板 -->


<!-- 资产操作面板 -->
@*<section class="content">*@
    @RenderBody()
@*</section>*@
<script src="/Assets/bootstrap-paginator/bootstrap-paginator.min.js"></script>
<script type="text/javascript">

    function queryData(pageIndex) {
        $("#PageIndex").val(pageIndex);
        var d = $("#frmSearch").serialize();
        $.post("@Url.Action("AssetsQuery")", d, function(result) {
            $("#tableAssets tbody").empty();
            $(result.Items).each(function(index, item) {
                var row = $(" <tr role='row'>");
                row.append('<td><a target="_blank" href="/AssetsFind/AssetsFind/ViewDetail?entityId=' + item.EntityId + '">' + item.AssetsNum + '</a></td>');
                row.append('<td>' + item.GoodsName + '</td>');
                row.append('<td>' + item.CatCode + '</td>');
                row.append('<td>' + item.Price + '</td>');
                row.append('<td>' + item.Counts + '</td>');
                row.append('<td>' + item.MeasurementUnits + '</td>');
                row.append('<td>' + item.UsingState + '</td>');
                row.append('<td><input type="checkbox" data-id=' + item.EntityId + '></td>');
                $("#tableAssets").append(row);
            });
            $("#example1_info").text("显示 " + result.StartRecordIndex + " 到 " + result.EndRecordIndex + " ,总共 " + result.TotalItemCount);
            var options = {
                bootstrapMajorVersion: 3, //版本
                numberOfPages: 8,
                currentPage: result.CurrentPageIndex,
                totalPages: result.TotalPageCount,
                itemTexts: function(type, page, current) {
                    switch (type) {
                    case "first":
                        return "首页";
                    case "prev":
                        return "上一页";
                    case "next":
                        return "下一页";
                    case "last":
                        return "末页";
                    case "page":
                        return page;
                    }
                }, //点击事件，用于通过Ajax来刷新整个list列表
                onPageClicked: function(event, originalEvent, type, page) {
                    queryData(page);
                }
            };
            $('#divAssetsPager').bootstrapPaginator(options);
            $(".orderlist").click(function() {
                var val = $(this).attr("data-id");
                addToOrderList(val);
            });
        }, "json");
    }

    function addToOrderList(entityId) {
        $.post("@Url.Action("Add", "OrderList", new {area = "Account"})",{EntityId:entityId}, function(result) {
            if (result)
                alert("添加成功");
            else
                alert("添加失败");
        }, "json");
   }

    $(function() {
        $("#perPageSize").change(function() {
            alert($(this).val());
            $("#PageSize").val($(this).val());
            queryData(1);
        });

        queryData(1);
        $("#btnSearch").click(function() { //点击查询按钮后从第一页开始查询
            queryData(1);
            return false;
        });
    });
</script>